
import de.undercouch.gradle.tasks.download.Download

buildscript {
	repositories {
		jcenter()
		maven {
			name 'forge'
			url 'http://files.minecraftforge.net/maven'
		}
	}
	dependencies {
		classpath 'net.minecraftforge.gradle:ForgeGradle:2.3-SNAPSHOT'
	}
}

plugins {
	id 'org.ajoberstar.grgit' version '2.1.0'
	id 'de.undercouch.download' version '3.3.0'
}

/*
repositories {
	mavenCentral()
	maven {
		name 'Tehnut Repo'
		url 'http://tehnut.info/maven'
	}
	maven {
		name 'Progwm16 Repo'
		url 'http://dvs1.progwml6.com/files/maven'
	}
	maven {
		name 'CoFH Repo'
		url 'http://maven.covers1624.net'
	}
	maven {
		name 'ChickenBones Repo'
		url 'http://chickenbones.net/maven'
	}
}
*/

apply plugin: 'net.minecraftforge.gradle.forge'

task wrapper(type: Wrapper) {
	gradleVersion = gradle_version
}

task setupWorkspace(type: Download, dependsOn: setupDecompWorkspace) {
	def forgeArchive = project.file('forge.zip')

	src 'http://files.minecraftforge.net/maven/net/minecraftforge/forge/' + forge_version + '/forge-' + forge_version + '-mdk.zip'
	dest forgeArchive

	doLast {
		project.copy {
			from zipTree(forgeArchive)
			into 'forge'
		}

		project.file('forge/eclipse').renameTo(project.file('eclipse'))

		project.file('forge.zip').delete()
		project.file('forge').deleteDir()
	}
}

version = grgit.describe(longDescr: true)
group = mod_group
archivesBaseName = mod_id

sourceCompatibility = 1.8
targetCompatibility = 1.8

minecraft {
	version = forge_version
	mappings = forge_mappings
	runDir = 'run'
	useDepAts = true
	makeObfSourceJar = false

	replaceIn "${mod_id}.java"
	replace "$version", project.version
}

/*
dependencies {
	//deobfCompile 'mezz.jei:jei_1.12.2:4.8.0.114'
	deobfCompile 'mcp.mobius.waila:Hwyla:1.8.22-B37_1.12'
	deobfCompile 'codechicken:CodeChickenLib:1.12-3.1.3.313:deobf'

	deobfCompile 'cofh:RedstoneFlux:1.12-2.0.1.2:universal' // required by CoFHCore
	deobfCompile 'cofh:CoFHCore:1.12-4.3.6.14:universal' // required by ThermalFoundation
	deobfCompile 'cofh:CoFHWorld:1.12-1.0.1.8:universal' // required by ThermalFoundation
	deobfCompile 'cofh:ThermalFoundation:1.12-2.3.6.16:universal'
}
*/

processResources {
	exclude '**/*.db'
	exclude '**/*.DS_Store'
}

build {
	doLast {
		project.file('release').deleteDir()
		project.file('build/libs').renameTo(project.file('release'))
		project.file('build/tmp/recompileMc/sources').renameTo(project.file('minecraftSrc'))
	}
}
